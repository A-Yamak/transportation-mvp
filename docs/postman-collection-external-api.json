{
  "info": {
    "name": "Transportation MVP - External API",
    "description": "API collection for Melo ERP integration",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "auth": {
    "type": "apikey",
    "apikey": [
      {
        "key": "key",
        "value": "X-API-Key",
        "type": "string"
      },
      {
        "key": "value",
        "value": "{{api_key}}",
        "type": "string"
      },
      {
        "key": "in",
        "value": "header",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "Shop Management",
      "item": [
        {
          "name": "Sync Shops",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"shops\": [\n    {\n      \"id\": \"SHOP-001\",\n      \"name\": \"Ahmad's Supermarket\",\n      \"address\": \"123 King Abdullah St, Amman\",\n      \"latitude\": 31.9539,\n      \"longitude\": 35.9106,\n      \"contact_name\": \"Ahmad Al-Rashid\",\n      \"contact_number\": \"+962791234567\",\n      \"track_waste\": true,\n      \"status\": \"active\"\n    },\n    {\n      \"id\": \"SHOP-002\",\n      \"name\": \"Fresh Goods Market\",\n      \"address\": \"456 Rainbow St, Zarqa\",\n      \"latitude\": 32.0573,\n      \"longitude\": 35.8497,\n      \"contact_name\": \"Fatima Al-Shami\",\n      \"contact_number\": \"+962798765432\",\n      \"track_waste\": true,\n      \"status\": \"active\"\n    }\n  ]\n}\n"
            },
            "url": {
              "raw": "{{base_url}}/api/external/v1/shops/sync",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "external",
                "v1",
                "shops",
                "sync"
              ]
            },
            "description": "Bulk synchronize shops from Melo ERP"
          },
          "response": []
        },
        {
          "name": "List Shops",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/external/v1/shops?is_active=true&track_waste=true&page=1&per_page=50",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "external",
                "v1",
                "shops"
              ],
              "query": [
                {
                  "key": "is_active",
                  "value": "true",
                  "disabled": false
                },
                {
                  "key": "track_waste",
                  "value": "true",
                  "disabled": false
                },
                {
                  "key": "page",
                  "value": "1",
                  "disabled": false
                },
                {
                  "key": "per_page",
                  "value": "50",
                  "disabled": false
                }
              ]
            },
            "description": "Retrieve all shops for the authenticated business"
          },
          "response": []
        },
        {
          "name": "Get Shop Details",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/external/v1/shops/SHOP-001",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "external",
                "v1",
                "shops",
                "SHOP-001"
              ]
            },
            "description": "Retrieve details of a specific shop by external ID"
          },
          "response": []
        },
        {
          "name": "Update Shop",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"track_waste\": true,\n  \"contact_number\": \"+962798765432\"\n}\n"
            },
            "url": {
              "raw": "{{base_url}}/api/external/v1/shops/SHOP-001",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "external",
                "v1",
                "shops",
                "SHOP-001"
              ]
            },
            "description": "Update a shop's details"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Waste Collection",
      "item": [
        {
          "name": "Get Expected Waste",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/external/v1/waste/expected",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "external",
                "v1",
                "waste",
                "expected"
              ]
            },
            "description": "Retrieve shops with expected waste to be collected"
          },
          "response": []
        },
        {
          "name": "Set Expected Waste Dates",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"shops\": [\n    {\n      \"external_shop_id\": \"SHOP-001\",\n      \"expected_waste_date\": \"2026-01-10\"\n    },\n    {\n      \"external_shop_id\": \"SHOP-002\",\n      \"expected_waste_date\": \"2026-01-10\"\n    }\n  ]\n}\n"
            },
            "url": {
              "raw": "{{base_url}}/api/external/v1/waste/expected",
              "host": [
                "{{base_url}}"
              ],
              "path": [
                "api",
                "external",
                "v1",
                "waste",
                "expected"
              ]
            },
            "description": "Tell Transportation MVP which shops have expected waste"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Testing - Waste Callback Simulation",
      "item": [
        {
          "name": "Simulate Waste Callback (Test Only)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              },
              {
                "key": "X-Webhook-Signature",
                "value": "{{webhook_signature}}",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"waste_collected\",\n  \"shop_id\": \"SHOP-001\",\n  \"shop_name\": \"Ahmad's Supermarket\",\n  \"collection_date\": \"2026-01-09\",\n  \"collected_at\": \"2026-01-09T14:30:00Z\",\n  \"collected_by_user_id\": 789,\n  \"waste_items\": [\n    {\n      \"order_item_id\": \"ITEM-456\",\n      \"product_name\": \"Baklava Box\",\n      \"quantity_delivered\": 10,\n      \"pieces_returned\": 3,\n      \"pieces_sold\": 7,\n      \"waste_date\": \"2026-01-01\",\n      \"notes\": \"Packaging damaged\"\n    },\n    {\n      \"order_item_id\": \"ITEM-457\",\n      \"product_name\": \"Kunafa Tray\",\n      \"quantity_delivered\": 5,\n      \"pieces_returned\": 0,\n      \"pieces_sold\": 5,\n      \"waste_date\": \"2026-01-02\",\n      \"notes\": null\n    }\n  ]\n}\n"
            },
            "url": {
              "raw": "{{melo_erp_webhook_url}}/api/v1/waste/callback",
              "protocol": "https",
              "host": [
                "{{melo_erp_webhook_url}}"
              ],
              "path": [
                "api",
                "v1",
                "waste",
                "callback"
              ]
            },
            "description": "Simulate a waste collection callback from Transportation MVP (for testing webhook receiver)"
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "https://transportation-app.alsabiqoon.com",
      "type": "string"
    },
    {
      "key": "api_key",
      "value": "your_api_key_here",
      "type": "string"
    },
    {
      "key": "melo_erp_webhook_url",
      "value": "https://your-melo-erp.com",
      "type": "string"
    },
    {
      "key": "webhook_signature",
      "value": "generated_signature_here",
      "type": "string"
    }
  ]
}
