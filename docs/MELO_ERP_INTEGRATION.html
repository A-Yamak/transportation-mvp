<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Melo ERP Integration - Transportation App</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #16a34a;
            --warning: #ca8a04;
            --danger: #dc2626;
            --orange: #ea580c;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background: var(--gray-50);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .badge-success { background: var(--success); color: white; }
        .badge-warning { background: var(--warning); color: white; }
        .badge-primary { background: var(--primary); color: white; }
        .badge-orange { background: var(--orange); color: white; }

        /* Navigation */
        nav {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        nav a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        nav a:hover {
            text-decoration: underline;
        }

        /* Sections */
        section {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        h2 {
            color: var(--gray-900);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
        }

        h3 {
            color: var(--gray-800);
            font-size: 1.25rem;
            margin: 1.5rem 0 1rem;
        }

        h4 {
            color: var(--gray-700);
            font-size: 1rem;
            margin: 1rem 0 0.5rem;
        }

        p {
            margin-bottom: 1rem;
            color: var(--gray-600);
        }

        /* Flow Diagram */
        .flow-diagram {
            background: var(--gray-100);
            border-radius: 0.5rem;
            padding: 2rem;
            margin: 1.5rem 0;
            overflow-x: auto;
        }

        .flow-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 800px;
            gap: 1rem;
        }

        .flow-box {
            background: white;
            border: 2px solid var(--gray-300);
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            min-width: 180px;
            position: relative;
        }

        .flow-box.primary {
            border-color: var(--primary);
            background: #eff6ff;
        }

        .flow-box.success {
            border-color: var(--success);
            background: #f0fdf4;
        }

        .flow-box h4 {
            margin: 0 0 0.5rem;
            color: var(--gray-900);
        }

        .flow-box p {
            margin: 0;
            font-size: 0.875rem;
        }

        .flow-arrow {
            font-size: 2rem;
            color: var(--gray-400);
            flex-shrink: 0;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 2rem;
            margin: 1.5rem 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--gray-300);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 2rem;
        }

        .timeline-item:last-child {
            padding-bottom: 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -1.5rem;
            top: 0.25rem;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid white;
            box-shadow: 0 0 0 2px var(--primary);
        }

        .timeline-item.success::before {
            background: var(--success);
            box-shadow: 0 0 0 2px var(--success);
        }

        .timeline-content {
            background: var(--gray-50);
            border-radius: 0.5rem;
            padding: 1rem;
            border-left: 3px solid var(--primary);
        }

        .timeline-item.success .timeline-content {
            border-left-color: var(--success);
        }

        /* Code blocks */
        pre {
            background: var(--gray-900);
            color: #e5e7eb;
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1rem 0;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        code {
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
        }

        .inline-code {
            background: var(--gray-100);
            color: var(--danger);
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }

        /* JSON syntax highlighting */
        .json-key { color: #7dd3fc; }
        .json-string { color: #86efac; }
        .json-number { color: #fcd34d; }
        .json-boolean { color: #f472b6; }
        .json-comment { color: #9ca3af; }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        th {
            background: var(--gray-100);
            font-weight: 600;
            color: var(--gray-700);
        }

        tr:hover {
            background: var(--gray-50);
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .card {
            background: var(--gray-50);
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid var(--gray-200);
        }

        .card h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .card-icon {
            width: 2rem;
            height: 2rem;
            background: var(--primary);
            color: white;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* API Endpoint */
        .endpoint {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: var(--gray-100);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            font-family: monospace;
        }

        .method {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .method-post { background: var(--success); color: white; }
        .method-get { background: var(--primary); color: white; }
        .method-put { background: var(--warning); color: white; }

        /* Sequence Diagram */
        .sequence-diagram {
            background: var(--gray-100);
            border-radius: 0.5rem;
            padding: 2rem;
            margin: 1.5rem 0;
            overflow-x: auto;
        }

        .sequence-row {
            display: grid;
            grid-template-columns: 120px 1fr 120px 1fr 120px;
            gap: 0.5rem;
            margin-bottom: 1rem;
            min-width: 700px;
        }

        .sequence-actor {
            background: var(--primary);
            color: white;
            padding: 0.75rem;
            text-align: center;
            border-radius: 0.375rem;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .sequence-line {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .sequence-line::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gray-400);
        }

        .sequence-arrow {
            background: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            position: relative;
            z-index: 1;
            white-space: nowrap;
        }

        .sequence-arrow.right::after {
            content: ' ->';
        }

        .sequence-arrow.left::before {
            content: '<- ';
        }

        /* Alert boxes */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border-left: 4px solid;
        }

        .alert-info {
            background: #eff6ff;
            border-color: var(--primary);
            color: var(--primary-dark);
        }

        .alert-success {
            background: #f0fdf4;
            border-color: var(--success);
            color: #166534;
        }

        .alert-warning {
            background: #fefce8;
            border-color: var(--warning);
            color: #854d0e;
        }

        .alert-orange {
            background: #fff7ed;
            border-color: var(--orange);
            color: #9a3412;
        }

        /* Schema transformation */
        .transform-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: center;
            margin: 1.5rem 0;
        }

        .transform-box {
            background: var(--gray-900);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .transform-box h5 {
            color: var(--gray-400);
            font-size: 0.75rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .transform-arrow {
            font-size: 2rem;
            color: var(--success);
        }

        /* Feature highlight */
        .feature-new {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid var(--warning);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .feature-new h3 {
            color: #92400e;
            margin-top: 0;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--gray-600);
            border-top: 1px solid var(--gray-200);
            margin-top: 2rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            header {
                padding: 2rem 0;
            }

            header h1 {
                font-size: 1.75rem;
            }

            nav ul {
                flex-direction: column;
                gap: 0.5rem;
            }

            .transform-container {
                grid-template-columns: 1fr;
            }

            .transform-arrow {
                transform: rotate(90deg);
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Melo ERP Integration</h1>
            <p>Complete Integration Guide for Transportation App</p>
            <div style="margin-top: 1rem;">
                <span class="badge badge-success">Production Ready</span>
                <span class="badge badge-primary">API v1</span>
                <span class="badge badge-warning">OAuth2</span>
                <span class="badge badge-orange">Partial Delivery</span>
            </div>
        </div>
    </header>

    <div class="container">
        <nav>
            <ul>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#architecture">Architecture</a></li>
                <li><a href="#flow">Integration Flow</a></li>
                <li><a href="#authentication">Authentication</a></li>
                <li><a href="#schema">Schema Transformation</a></li>
                <li><a href="#endpoints">API Endpoints</a></li>
                <li><a href="#partial-delivery">Partial Delivery</a></li>
                <li><a href="#callbacks">Callbacks</a></li>
                <li><a href="#testing">Testing</a></li>
            </ul>
        </nav>

        <!-- Overview Section -->
        <section id="overview">
            <h2>Overview</h2>
            <p>
                This document describes the complete integration between <strong>Melo Group ERP</strong> and the
                <strong>Transportation App</strong>. The integration enables Melo's ERP system to submit delivery
                orders with item-level tracking and receive real-time status callbacks when deliveries are completed,
                including partial delivery reporting.
            </p>

            <div class="cards-grid">
                <div class="card">
                    <h4><div class="card-icon">1</div> Submit Orders</h4>
                    <p>Melo ERP sends delivery requests with destinations and <strong>item details</strong> (SKU, product name, quantity).</p>
                </div>
                <div class="card">
                    <h4><div class="card-icon">2</div> Route Optimization</h4>
                    <p>Transportation App optimizes the route using Google Maps Directions API for efficient delivery.</p>
                </div>
                <div class="card">
                    <h4><div class="card-icon">3</div> Driver Execution</h4>
                    <p>Driver delivers items and reports <strong>quantities delivered</strong>, with reasons for any discrepancies.</p>
                </div>
                <div class="card">
                    <h4><div class="card-icon">4</div> Status Callbacks</h4>
                    <p>Callbacks include <strong>item-level delivery data</strong> with quantities, reasons, and notes.</p>
                </div>
            </div>

            <div class="feature-new">
                <h3>New: Partial Delivery Support</h3>
                <p>
                    The integration now supports <strong>item-level tracking</strong>. Melo can send expected items
                    with each destination, and receive callbacks with actual delivered quantities. This enables:
                </p>
                <ul style="margin-left: 1.5rem; color: #92400e;">
                    <li>Track exactly which items were delivered vs ordered</li>
                    <li>Report reasons for shortages (damaged, refused, quality issues)</li>
                    <li>Automatic inventory reconciliation in Melo ERP</li>
                </ul>
            </div>
        </section>

        <!-- Architecture Section -->
        <section id="architecture">
            <h2>System Architecture</h2>

            <div class="flow-diagram">
                <div class="flow-container">
                    <div class="flow-box">
                        <h4>Melo ERP</h4>
                        <p>Order + Items</p>
                    </div>
                    <div class="flow-arrow">-></div>
                    <div class="flow-box primary">
                        <h4>Transportation API</h4>
                        <p>Laravel Backend</p>
                    </div>
                    <div class="flow-arrow">-></div>
                    <div class="flow-box">
                        <h4>Driver App</h4>
                        <p>Flutter Mobile</p>
                    </div>
                    <div class="flow-arrow">-></div>
                    <div class="flow-box success">
                        <h4>Delivery</h4>
                        <p>Items + Quantities</p>
                    </div>
                </div>
            </div>

            <h3>Technology Stack</h3>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Technology</th>
                        <th>Purpose</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Backend API</td>
                        <td>Laravel 12 + FrankenPHP/Octane</td>
                        <td>REST API, Business Logic, Queue Processing</td>
                    </tr>
                    <tr>
                        <td>Driver Mobile App</td>
                        <td>Flutter (iOS/Android)</td>
                        <td>Trip management, GPS tracking, Item-level delivery confirmation</td>
                    </tr>
                    <tr>
                        <td>Database</td>
                        <td>MySQL 8.0</td>
                        <td>Persistent data storage, destination_items table</td>
                    </tr>
                    <tr>
                        <td>Queue/Cache</td>
                        <td>Redis 7</td>
                        <td>Job queues, Caching, Session storage</td>
                    </tr>
                    <tr>
                        <td>Route Optimization</td>
                        <td>Google Maps Directions API</td>
                        <td>Waypoint optimization, Distance calculation</td>
                    </tr>
                    <tr>
                        <td>Authentication</td>
                        <td>Laravel Passport (OAuth2)</td>
                        <td>API authentication for drivers</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Integration Flow Section -->
        <section id="flow">
            <h2>Complete Integration Flow</h2>

            <div class="sequence-diagram">
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 2rem; text-align: center; margin-bottom: 2rem;">
                    <div class="sequence-actor">Melo ERP</div>
                    <div class="sequence-actor">Transportation API</div>
                    <div class="sequence-actor">Driver App</div>
                    <div class="sequence-actor">Customer</div>
                </div>

                <div style="font-family: monospace; font-size: 0.875rem; line-height: 2;">
                    <div style="color: var(--success);">// Step 1: Order Submission (with Items)</div>
                    <div>Melo ERP ──────────── POST /delivery-requests + items ───────▶ Transportation API</div>
                    <div>Melo ERP ◀─────────── 201 Created + Request ID ─────────────── Transportation API</div>
                    <br>
                    <div style="color: var(--success);">// Step 2: Trip Assignment (Admin Panel)</div>
                    <div>                      Transportation API ── Assign Trip ──▶ Driver App</div>
                    <br>
                    <div style="color: var(--success);">// Step 3: Driver Authentication</div>
                    <div>                                              Driver App ── POST /auth/login ──▶ Transportation API</div>
                    <div>                                              Driver App ◀── JWT Token ────────── Transportation API</div>
                    <br>
                    <div style="color: var(--success);">// Step 4: Trip Execution</div>
                    <div>                                              Driver App ── POST /trips/{id}/start ──▶ Transportation API</div>
                    <div>                                              Driver App ── Navigate ──▶ Customer</div>
                    <div>                                              Driver App ── POST /destinations/{id}/arrive ──▶ Transportation API</div>
                    <div>                                              Driver App ── Deliver Items ──▶ Customer</div>
                    <div style="color: var(--orange);">                                              Driver App ── POST /complete + item quantities ──▶ Transportation API</div>
                    <br>
                    <div style="color: var(--success);">// Step 5: Callback to ERP (with Item Data)</div>
                    <div style="color: var(--orange);">Melo ERP ◀─────────── POST /callback + delivered_items[] ──── Transportation API</div>
                </div>
            </div>

            <h3>Step-by-Step Timeline</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-content">
                        <h4>Step 1: Melo ERP Submits Delivery Request with Items</h4>
                        <p>Melo's ERP system sends destinations with <strong>item arrays</strong> containing SKU, product name, and expected quantity.</p>
                        <div class="endpoint">
                            <span class="method method-post">POST</span>
                            <span>/api/v1/delivery-requests</span>
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-content">
                        <h4>Step 2: Schema Transformation</h4>
                        <p>The Transportation API transforms Melo's field names to internal format, including item fields.</p>
                        <code class="inline-code">sku</code> -> <code class="inline-code">order_item_id</code>,
                        <code class="inline-code">product_name</code> -> <code class="inline-code">name</code>,
                        <code class="inline-code">qty</code> -> <code class="inline-code">quantity_ordered</code>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-content">
                        <h4>Step 3: Route Optimization</h4>
                        <p>Google Maps Directions API optimizes the waypoint order for the most efficient route. Results are cached for 15 minutes.</p>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-content">
                        <h4>Step 4: Trip Assignment</h4>
                        <p>Admin assigns the delivery request to an available driver via the Filament admin panel. A Trip record is created.</p>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-content">
                        <h4>Step 5: Driver Login</h4>
                        <p>Driver opens the Flutter app and authenticates using OAuth2 Password Grant.</p>
                        <div class="endpoint">
                            <span class="method method-post">POST</span>
                            <span>/api/v1/auth/login</span>
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-content">
                        <h4>Step 6: Driver Starts Trip</h4>
                        <p>Driver views assigned trips and starts the delivery run. GPS tracking begins.</p>
                        <div class="endpoint">
                            <span class="method method-post">POST</span>
                            <span>/api/v1/driver/trips/{id}/start</span>
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-content">
                        <h4>Step 7: Navigate & Deliver with Item Tracking</h4>
                        <p>Driver navigates, marks arrival, and completes delivery <strong>with item quantities</strong>.</p>
                        <div class="endpoint">
                            <span class="method method-post">POST</span>
                            <span>/api/v1/driver/trips/{id}/destinations/{destId}/arrive</span>
                        </div>
                        <div class="endpoint">
                            <span class="method method-post">POST</span>
                            <span>/api/v1/driver/trips/{id}/destinations/{destId}/complete + items[]</span>
                        </div>
                    </div>
                </div>

                <div class="timeline-item success">
                    <div class="timeline-content">
                        <h4>Step 8: Callback with Item-Level Data</h4>
                        <p>Callback includes <strong>delivered_items[]</strong> array with quantities and discrepancy reasons.</p>
                        <div class="endpoint">
                            <span class="method method-post">POST</span>
                            <span>https://erp.melogroup.jo/api/delivery-callback</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Authentication Section -->
        <section id="authentication">
            <h2>Authentication</h2>

            <h3>ERP API Authentication (X-API-Key)</h3>
            <p>Melo ERP authenticates using an API key provided in the request header.</p>

            <pre><code><span class="json-key">Headers:</span>
  <span class="json-string">X-API-Key: melo_bCh2Jf9EggmvLL74mk2g7CONiP0GKqPk</span>
  <span class="json-string">Content-Type: application/json</span>
  <span class="json-string">Accept: application/json</span></code></pre>

            <div class="alert alert-info">
                <strong>Note:</strong> Each business client has a unique API key stored in the <code class="inline-code">businesses</code> table.
                The middleware validates the key and attaches the business to the request.
            </div>

            <h3>Driver App Authentication (OAuth2 Password Grant)</h3>
            <p>Drivers authenticate using email/password, receiving JWT tokens for subsequent requests.</p>

            <h4>Login Request</h4>
            <pre><code><span class="json-key">POST</span> /api/v1/auth/login

{
  <span class="json-key">"email"</span>: <span class="json-string">"driver@alsabiqoon.com"</span>,
  <span class="json-key">"password"</span>: <span class="json-string">"driver123"</span>
}</code></pre>

            <h4>Login Response</h4>
            <pre><code>{
  <span class="json-key">"access_token"</span>: <span class="json-string">"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9..."</span>,
  <span class="json-key">"refresh_token"</span>: <span class="json-string">"def502003f8a9b..."</span>,
  <span class="json-key">"expires_in"</span>: <span class="json-number">3600</span>,
  <span class="json-key">"token_type"</span>: <span class="json-string">"Bearer"</span>,
  <span class="json-key">"user"</span>: {
    <span class="json-key">"id"</span>: <span class="json-number">82</span>,
    <span class="json-key">"name"</span>: <span class="json-string">"Ahmad Driver"</span>,
    <span class="json-key">"email"</span>: <span class="json-string">"driver@alsabiqoon.com"</span>
  }
}</code></pre>

            <h4>Using the Token</h4>
            <pre><code><span class="json-key">Headers:</span>
  <span class="json-string">Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...</span>
  <span class="json-string">Accept: application/json</span></code></pre>
        </section>

        <!-- Schema Transformation Section -->
        <section id="schema">
            <h2>Schema Transformation</h2>
            <p>
                The Transportation App uses configurable payload schemas to allow different ERPs to send data
                using their own field names. The schema transformation handles both destination fields and item fields.
            </p>

            <h3>Melo's Payload Schema</h3>
            <pre><code>{
  <span class="json-key">"request_schema"</span>: {
    <span class="json-comment">// Destination-level fields</span>
    <span class="json-key">"external_id"</span>: <span class="json-string">"order_id"</span>,
    <span class="json-key">"address"</span>: <span class="json-string">"delivery_address"</span>,
    <span class="json-key">"lat"</span>: <span class="json-string">"coordinates.latitude"</span>,
    <span class="json-key">"lng"</span>: <span class="json-string">"coordinates.longitude"</span>,
    <span class="json-key">"contact_name"</span>: <span class="json-string">"customer_name"</span>,
    <span class="json-key">"contact_phone"</span>: <span class="json-string">"customer_phone"</span>,
    <span class="json-key">"notes"</span>: <span class="json-string">"delivery_notes"</span>,
    <span class="json-comment">// Item-level fields</span>
    <span class="json-key">"items"</span>: <span class="json-string">"items"</span>,
    <span class="json-key">"items.order_item_id"</span>: <span class="json-string">"sku"</span>,
    <span class="json-key">"items.name"</span>: <span class="json-string">"product_name"</span>,
    <span class="json-key">"items.quantity_ordered"</span>: <span class="json-string">"qty"</span>
  },
  <span class="json-key">"callback_schema"</span>: {
    <span class="json-comment">// Destination-level callback fields</span>
    <span class="json-key">"external_id"</span>: <span class="json-string">"order_id"</span>,
    <span class="json-key">"status"</span>: <span class="json-string">"delivery_status"</span>,
    <span class="json-key">"completed_at"</span>: <span class="json-string">"delivered_at"</span>,
    <span class="json-key">"recipient_name"</span>: <span class="json-string">"received_by"</span>,
    <span class="json-comment">// Item-level callback fields</span>
    <span class="json-key">"items"</span>: <span class="json-string">"delivered_items"</span>,
    <span class="json-key">"items.order_item_id"</span>: <span class="json-string">"sku"</span>,
    <span class="json-key">"items.quantity_delivered"</span>: <span class="json-string">"qty_received"</span>,
    <span class="json-key">"items.reason"</span>: <span class="json-string">"discrepancy_reason"</span>,
    <span class="json-key">"items.notes"</span>: <span class="json-string">"item_notes"</span>
  }
}</code></pre>

            <h3>Request Transformation Example</h3>

            <div class="transform-container">
                <div class="transform-box">
                    <h5>Melo ERP Sends (Their Format)</h5>
                    <pre style="margin: 0; background: transparent;"><code>{
  <span class="json-key">"order_id"</span>: <span class="json-string">"MELO-20260107-001"</span>,
  <span class="json-key">"delivery_address"</span>: <span class="json-string">"Rainbow St 45"</span>,
  <span class="json-key">"coordinates"</span>: {
    <span class="json-key">"latitude"</span>: <span class="json-number">31.9515</span>,
    <span class="json-key">"longitude"</span>: <span class="json-number">35.9239</span>
  },
  <span class="json-key">"items"</span>: [
    {
      <span class="json-key">"sku"</span>: <span class="json-string">"CHOC-001"</span>,
      <span class="json-key">"product_name"</span>: <span class="json-string">"Premium Chocolate"</span>,
      <span class="json-key">"qty"</span>: <span class="json-number">10</span>
    }
  ]
}</code></pre>
                </div>

                <div class="transform-arrow">-></div>

                <div class="transform-box">
                    <h5>Internal Format (After Transform)</h5>
                    <pre style="margin: 0; background: transparent;"><code>{
  <span class="json-key">"external_id"</span>: <span class="json-string">"MELO-20260107-001"</span>,
  <span class="json-key">"address"</span>: <span class="json-string">"Rainbow St 45"</span>,
  <span class="json-key">"lat"</span>: <span class="json-number">31.9515</span>,
  <span class="json-key">"lng"</span>: <span class="json-number">35.9239</span>,
  <span class="json-key">"items"</span>: [
    {
      <span class="json-key">"order_item_id"</span>: <span class="json-string">"CHOC-001"</span>,
      <span class="json-key">"name"</span>: <span class="json-string">"Premium Chocolate"</span>,
      <span class="json-key">"quantity_ordered"</span>: <span class="json-number">10</span>
    }
  ]
}</code></pre>
                </div>
            </div>

            <div class="alert alert-success">
                <strong>Benefit:</strong> Melo doesn't need to change their ERP output format. The Transportation App
                adapts to their field names via the configurable schema - including item-level fields.
            </div>
        </section>

        <!-- API Endpoints Section -->
        <section id="endpoints">
            <h2>API Endpoints</h2>

            <h3>ERP Integration Endpoints</h3>
            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>Description</th>
                        <th>Auth</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="method method-post">POST</span></td>
                        <td><code>/api/v1/delivery-requests</code></td>
                        <td>Submit delivery request with destinations and items</td>
                        <td>X-API-Key</td>
                    </tr>
                    <tr>
                        <td><span class="method method-get">GET</span></td>
                        <td><code>/api/v1/delivery-requests/{id}</code></td>
                        <td>Get delivery request status</td>
                        <td>X-API-Key</td>
                    </tr>
                </tbody>
            </table>

            <h3>Driver App Endpoints</h3>
            <table>
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="method method-post">POST</span></td>
                        <td><code>/api/v1/auth/login</code></td>
                        <td>Driver login (returns JWT token)</td>
                    </tr>
                    <tr>
                        <td><span class="method method-post">POST</span></td>
                        <td><code>/api/v1/auth/refresh</code></td>
                        <td>Refresh access token</td>
                    </tr>
                    <tr>
                        <td><span class="method method-get">GET</span></td>
                        <td><code>/api/v1/driver/trips/today</code></td>
                        <td>Get today's assigned trips</td>
                    </tr>
                    <tr>
                        <td><span class="method method-get">GET</span></td>
                        <td><code>/api/v1/driver/trips/{id}</code></td>
                        <td>Get trip details with destinations and items</td>
                    </tr>
                    <tr>
                        <td><span class="method method-post">POST</span></td>
                        <td><code>/api/v1/driver/trips/{id}/start</code></td>
                        <td>Start a trip (with GPS coordinates)</td>
                    </tr>
                    <tr>
                        <td><span class="method method-post">POST</span></td>
                        <td><code>/api/v1/driver/trips/{id}/destinations/{destId}/arrive</code></td>
                        <td>Mark arrival at destination</td>
                    </tr>
                    <tr>
                        <td><span class="method method-post">POST</span></td>
                        <td><code>/api/v1/driver/trips/{id}/destinations/{destId}/complete</code></td>
                        <td>Complete delivery with item quantities (triggers callback)</td>
                    </tr>
                    <tr>
                        <td><span class="method method-post">POST</span></td>
                        <td><code>/api/v1/driver/trips/{id}/destinations/{destId}/fail</code></td>
                        <td>Mark delivery as failed</td>
                    </tr>
                </tbody>
            </table>

            <h3>Create Delivery Request - Full Example with Items</h3>

            <h4>Request</h4>
            <pre><code><span class="json-key">POST</span> /api/v1/delivery-requests
<span class="json-key">Headers:</span>
  X-API-Key: melo_bCh2Jf9EggmvLL74mk2g7CONiP0GKqPk
  Content-Type: application/json

{
  <span class="json-key">"destinations"</span>: [
    {
      <span class="json-key">"order_id"</span>: <span class="json-string">"MELO-20260107-001"</span>,
      <span class="json-key">"delivery_address"</span>: <span class="json-string">"Rainbow Street 45, Jabal Amman"</span>,
      <span class="json-key">"coordinates"</span>: {
        <span class="json-key">"latitude"</span>: <span class="json-number">31.9515</span>,
        <span class="json-key">"longitude"</span>: <span class="json-number">35.9239</span>
      },
      <span class="json-key">"customer_name"</span>: <span class="json-string">"Al-Quds Sweets"</span>,
      <span class="json-key">"customer_phone"</span>: <span class="json-string">"+962791234567"</span>,
      <span class="json-key">"delivery_notes"</span>: <span class="json-string">"Back entrance, ask for Abu Ahmad"</span>,
      <span class="json-key">"items"</span>: [
        {
          <span class="json-key">"sku"</span>: <span class="json-string">"CHOC-001"</span>,
          <span class="json-key">"product_name"</span>: <span class="json-string">"Premium Chocolate Box"</span>,
          <span class="json-key">"qty"</span>: <span class="json-number">10</span>
        },
        {
          <span class="json-key">"sku"</span>: <span class="json-string">"CAKE-002"</span>,
          <span class="json-key">"product_name"</span>: <span class="json-string">"Birthday Cake Assortment"</span>,
          <span class="json-key">"qty"</span>: <span class="json-number">5</span>
        }
      ]
    },
    {
      <span class="json-key">"order_id"</span>: <span class="json-string">"MELO-20260107-002"</span>,
      <span class="json-key">"delivery_address"</span>: <span class="json-string">"Mecca Street 123, Abdoun"</span>,
      <span class="json-key">"coordinates"</span>: {
        <span class="json-key">"latitude"</span>: <span class="json-number">31.9544</span>,
        <span class="json-key">"longitude"</span>: <span class="json-number">35.8789</span>
      },
      <span class="json-key">"customer_name"</span>: <span class="json-string">"Sweet Palace"</span>,
      <span class="json-key">"customer_phone"</span>: <span class="json-string">"+962797654321"</span>,
      <span class="json-key">"delivery_notes"</span>: <span class="json-string">"Morning delivery preferred"</span>,
      <span class="json-key">"items"</span>: [
        {
          <span class="json-key">"sku"</span>: <span class="json-string">"PAST-003"</span>,
          <span class="json-key">"product_name"</span>: <span class="json-string">"Baklava Selection"</span>,
          <span class="json-key">"qty"</span>: <span class="json-number">20</span>
        },
        {
          <span class="json-key">"sku"</span>: <span class="json-string">"COOK-004"</span>,
          <span class="json-key">"product_name"</span>: <span class="json-string">"Butter Cookies"</span>,
          <span class="json-key">"qty"</span>: <span class="json-number">15</span>
        }
      ]
    }
  ]
}</code></pre>

            <h4>Response (201 Created)</h4>
            <pre><code>{
  <span class="json-key">"data"</span>: {
    <span class="json-key">"id"</span>: <span class="json-string">"019b9862-58cb-70be-a378-60f2233bd119"</span>,
    <span class="json-key">"status"</span>: <span class="json-string">"pending"</span>,
    <span class="json-key">"total_km"</span>: <span class="json-number">10.5</span>,
    <span class="json-key">"estimated_cost"</span>: <span class="json-number">5.25</span>,
    <span class="json-key">"created_at"</span>: <span class="json-string">"2026-01-07T12:15:30+00:00"</span>,
    <span class="json-key">"destinations"</span>: [
      {
        <span class="json-key">"id"</span>: <span class="json-string">"019b9862-58d1-..."</span>,
        <span class="json-key">"external_id"</span>: <span class="json-string">"MELO-20260107-001"</span>,
        <span class="json-key">"sequence_order"</span>: <span class="json-number">1</span>,
        <span class="json-key">"status"</span>: <span class="json-string">"pending"</span>,
        <span class="json-key">"items"</span>: [
          { <span class="json-key">"order_item_id"</span>: <span class="json-string">"CHOC-001"</span>, <span class="json-key">"name"</span>: <span class="json-string">"Premium Chocolate Box"</span>, <span class="json-key">"quantity_ordered"</span>: <span class="json-number">10</span> },
          { <span class="json-key">"order_item_id"</span>: <span class="json-string">"CAKE-002"</span>, <span class="json-key">"name"</span>: <span class="json-string">"Birthday Cake Assortment"</span>, <span class="json-key">"quantity_ordered"</span>: <span class="json-number">5</span> }
        ]
      },
      {
        <span class="json-key">"id"</span>: <span class="json-string">"019b9862-58d2-..."</span>,
        <span class="json-key">"external_id"</span>: <span class="json-string">"MELO-20260107-002"</span>,
        <span class="json-key">"sequence_order"</span>: <span class="json-number">2</span>,
        <span class="json-key">"status"</span>: <span class="json-string">"pending"</span>,
        <span class="json-key">"items"</span>: [
          { <span class="json-key">"order_item_id"</span>: <span class="json-string">"PAST-003"</span>, <span class="json-key">"name"</span>: <span class="json-string">"Baklava Selection"</span>, <span class="json-key">"quantity_ordered"</span>: <span class="json-number">20</span> },
          { <span class="json-key">"order_item_id"</span>: <span class="json-string">"COOK-004"</span>, <span class="json-key">"name"</span>: <span class="json-string">"Butter Cookies"</span>, <span class="json-key">"quantity_ordered"</span>: <span class="json-number">15</span> }
        ]
      }
    ]
  }
}</code></pre>
        </section>

        <!-- Partial Delivery Section -->
        <section id="partial-delivery">
            <h2>Partial Delivery Tracking</h2>
            <p>
                The system supports tracking partial deliveries when not all items can be delivered as expected.
                Drivers can report the actual quantity delivered for each item, along with a reason for any discrepancy.
            </p>

            <h3>Item Delivery Reasons</h3>
            <table>
                <thead>
                    <tr>
                        <th>Reason Code</th>
                        <th>English</th>
                        <th>Arabic</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code class="inline-code">damaged_in_transit</code></td>
                        <td>Damaged in Transit</td>
                        <td>تلف أثناء النقل</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">customer_refused</code></td>
                        <td>Customer Refused</td>
                        <td>رفض العميل</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">quality_issue</code></td>
                        <td>Quality Issue</td>
                        <td>مشكلة جودة</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">wrong_product</code></td>
                        <td>Wrong Product</td>
                        <td>منتج خاطئ</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">shortage</code></td>
                        <td>Shortage</td>
                        <td>نقص</td>
                    </tr>
                    <tr>
                        <td><code class="inline-code">other</code></td>
                        <td>Other</td>
                        <td>سبب آخر</td>
                    </tr>
                </tbody>
            </table>

            <h3>Driver Completion Request with Items</h3>
            <pre><code><span class="json-key">POST</span> /api/v1/driver/trips/{tripId}/destinations/{destId}/complete
<span class="json-key">Headers:</span>
  Authorization: Bearer {driver_token}

{
  <span class="json-key">"recipient_name"</span>: <span class="json-string">"Um Omar"</span>,
  <span class="json-key">"notes"</span>: <span class="json-string">"Partial delivery - some items damaged"</span>,
  <span class="json-key">"lat"</span>: <span class="json-number">31.9544</span>,
  <span class="json-key">"lng"</span>: <span class="json-number">35.8789</span>,
  <span class="json-key">"items"</span>: [
    {
      <span class="json-key">"order_item_id"</span>: <span class="json-string">"PAST-003"</span>,
      <span class="json-key">"quantity_delivered"</span>: <span class="json-number">20</span>
    },
    {
      <span class="json-key">"order_item_id"</span>: <span class="json-string">"COOK-004"</span>,
      <span class="json-key">"quantity_delivered"</span>: <span class="json-number">10</span>,
      <span class="json-key">"reason"</span>: <span class="json-string">"damaged_in_transit"</span>,
      <span class="json-key">"notes"</span>: <span class="json-string">"5 boxes damaged during transport"</span>
    }
  ]
}</code></pre>

            <div class="alert alert-orange">
                <strong>Important:</strong> The <code class="inline-code">items</code> array is optional for backward compatibility.
                If not provided, the destination is marked complete without item-level tracking.
            </div>
        </section>

        <!-- Callbacks Section -->
        <section id="callbacks">
            <h2>Delivery Callbacks</h2>
            <p>
                When a driver marks a destination as complete, the Transportation App dispatches a background job
                to send a callback to Melo's configured callback URL, including item-level delivery data.
            </p>

            <h3>Callback Flow</h3>
            <div class="flow-diagram">
                <div class="flow-container">
                    <div class="flow-box">
                        <h4>Driver App</h4>
                        <p>Marks Complete + Items</p>
                    </div>
                    <div class="flow-arrow">-></div>
                    <div class="flow-box primary">
                        <h4>Transportation API</h4>
                        <p>Dispatches Job</p>
                    </div>
                    <div class="flow-arrow">-></div>
                    <div class="flow-box">
                        <h4>Horizon Queue</h4>
                        <p>Processes Job</p>
                    </div>
                    <div class="flow-arrow">-></div>
                    <div class="flow-box success">
                        <h4>Melo ERP</h4>
                        <p>Receives Items Data</p>
                    </div>
                </div>
            </div>

            <h3>Full Delivery Callback (All Items Delivered)</h3>
            <pre><code><span class="json-key">POST</span> https://erp.melogroup.jo/api/delivery-callback
<span class="json-key">Headers:</span>
  Authorization: Bearer callback_token_here
  Content-Type: application/json
  X-Signature: sha256=abc123...  <span class="json-comment">// HMAC signature for verification</span>

{
  <span class="json-key">"order_id"</span>: <span class="json-string">"MELO-20260107-001"</span>,
  <span class="json-key">"delivery_status"</span>: <span class="json-string">"completed"</span>,
  <span class="json-key">"delivered_at"</span>: <span class="json-string">"2026-01-07T12:30:45+00:00"</span>,
  <span class="json-key">"received_by"</span>: <span class="json-string">"Abu Ahmad"</span>,
  <span class="json-key">"delivered_items"</span>: [
    {
      <span class="json-key">"sku"</span>: <span class="json-string">"CHOC-001"</span>,
      <span class="json-key">"qty_received"</span>: <span class="json-number">10</span>
    },
    {
      <span class="json-key">"sku"</span>: <span class="json-string">"CAKE-002"</span>,
      <span class="json-key">"qty_received"</span>: <span class="json-number">5</span>
    }
  ]
}</code></pre>

            <h3>Partial Delivery Callback (With Discrepancies)</h3>
            <pre><code>{
  <span class="json-key">"order_id"</span>: <span class="json-string">"MELO-20260107-002"</span>,
  <span class="json-key">"delivery_status"</span>: <span class="json-string">"completed"</span>,
  <span class="json-key">"delivered_at"</span>: <span class="json-string">"2026-01-07T13:15:00+00:00"</span>,
  <span class="json-key">"received_by"</span>: <span class="json-string">"Um Omar"</span>,
  <span class="json-key">"driver_notes"</span>: <span class="json-string">"Partial delivery - some items damaged"</span>,
  <span class="json-key">"delivered_items"</span>: [
    {
      <span class="json-key">"sku"</span>: <span class="json-string">"PAST-003"</span>,
      <span class="json-key">"qty_received"</span>: <span class="json-number">20</span>
    },
    {
      <span class="json-key">"sku"</span>: <span class="json-string">"COOK-004"</span>,
      <span class="json-key">"qty_received"</span>: <span class="json-number">10</span>,
      <span class="json-key">"discrepancy_reason"</span>: <span class="json-string">"damaged_in_transit"</span>,
      <span class="json-key">"item_notes"</span>: <span class="json-string">"5 boxes damaged during transport"</span>
    }
  ]
}</code></pre>

            <h3>Failed Delivery Callback</h3>
            <pre><code>{
  <span class="json-key">"order_id"</span>: <span class="json-string">"MELO-20260107-003"</span>,
  <span class="json-key">"delivery_status"</span>: <span class="json-string">"failed"</span>,
  <span class="json-key">"failed_at"</span>: <span class="json-string">"2026-01-07T14:00:00+00:00"</span>,
  <span class="json-key">"failure_reason"</span>: <span class="json-string">"customer_unavailable"</span>,
  <span class="json-key">"driver_notes"</span>: <span class="json-string">"Shop was closed, attempted 3 times"</span>,
  <span class="json-key">"location"</span>: {
    <span class="json-key">"lat"</span>: <span class="json-number">31.9600</span>,
    <span class="json-key">"lng"</span>: <span class="json-number">35.9100</span>
  }
}</code></pre>

            <div class="alert alert-warning">
                <strong>Retry Policy:</strong> Failed callbacks are retried up to 3 times with exponential backoff
                (1 min, 5 min, 15 min). Failed callbacks are logged and can be manually retried from the admin panel.
            </div>
        </section>

        <!-- Testing Section -->
        <section id="testing">
            <h2>Local Testing</h2>
            <p>The Transportation App includes a complete integration test suite for validating the Melo ERP integration locally, including partial delivery scenarios.</p>

            <h3>Quick Start (3 Terminals)</h3>

            <div class="cards-grid">
                <div class="card">
                    <h4>Terminal 1: Start Backend</h4>
                    <pre style="margin: 0.5rem 0;"><code>cd transportation-mvp
docker compose up -d</code></pre>
                </div>
                <div class="card">
                    <h4>Terminal 2: Webhook Receiver</h4>
                    <pre style="margin: 0.5rem 0;"><code>docker compose exec backend \
  php artisan webhook:receive</code></pre>
                </div>
                <div class="card">
                    <h4>Terminal 3: Run Test</h4>
                    <pre style="margin: 0.5rem 0;"><code>docker compose exec backend \
  php artisan test:melo-integration</code></pre>
                </div>
            </div>

            <h3>Test Output Example (with Partial Delivery)</h3>
            <pre><code>╔════════════════════════════════════════════════════════════╗
║         MELO ERP INTEGRATION TEST                          ║
╚════════════════════════════════════════════════════════════╝

STEP 0: Setup
─────────────────────────────────────────
  ✓ Found Melo Group (API Key: melo_du5UteiItI...)
  ✓ Updated callback URL to: http://localhost:9999/api/delivery-callback
  ✓ Found test driver: Ahmad Driver

STEP 1: ERP Submits Delivery Request
─────────────────────────────────────────
  Sending to: POST /api/v1/delivery-requests
  Payload includes items: CHOC-001, CAKE-002, PAST-003, COOK-004
  ✓ Created DeliveryRequest: 019b9889-be20-7100-a5fa-...
  ✓ Status: pending
  ✓ Destinations: 2

STEP 2: Admin Assigns Trip to Driver
─────────────────────────────────────────
  ✓ Created Trip: 019b9889-be51-715c-bfc0-...
  ✓ Assigned to: Ahmad Driver
  ✓ Vehicle: Volkswagen Caddy (2019)

STEP 3: Driver Logs In
─────────────────────────────────────────
  ✓ Driver logged in successfully
  ✓ Token: eyJ0eXAiOiJKV1QiLCJh...

STEP 4: Driver Starts Trip
─────────────────────────────────────────
  ✓ Trip started at: 2026-01-07T12:58:43+00:00
  ✓ Status: in_progress

STEP 5: Driver Completes Destinations (Triggers Callbacks)
─────────────────────────────────────────
  Processing destination 1: MELO-20260107-001
    ✓ Arrived
    Items for this destination:
      - Birthday Cake Assortment (SKU: CAKE-002): 5 ordered
      - Premium Chocolate Box (SKU: CHOC-001): 10 ordered
    Submitting 2 item(s) with delivery data
    ✓ Completed (FULL DELIVERY) - CALLBACK SHOULD BE SENT!

  Processing destination 2: MELO-20260107-002
    ✓ Arrived
    Items for this destination:
      - Butter Cookies (SKU: COOK-004): 15 ordered
      - Baklava Selection (SKU: PAST-003): 20 ordered
    Submitting 2 item(s) with delivery data
    ✓ Completed (PARTIAL DELIVERY) - CALLBACK SHOULD BE SENT!

═══════════════════════════════════════════════════════════
                    TEST COMPLETE
═══════════════════════════════════════════════════════════

Summary:
  Trip ID: 019b9889-be51-715c-bfc0-de7da0efab41
  Trip Status: in_progress
  Destinations completed: 2

Item Delivery Summary:
  Destination 1: MELO-20260107-001
    - CAKE-002: ✓ Full
    - CHOC-001: ✓ Full
  Destination 2: MELO-20260107-002
    - COOK-004: ⚠ Partial (10/15)
      Reason: damaged_in_transit
    - PAST-003: ✓ Full

Check the webhook receiver terminal for callbacks!
Callbacks should contain (using Melo field names):
  - order_id (external_id)
  - delivery_status
  - delivered_at
  - received_by
  - delivered_items[] (with sku, qty_received, discrepancy_reason)</code></pre>

            <h3>Test Data Reference</h3>
            <table>
                <thead>
                    <tr>
                        <th>Resource</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Melo API Key</td>
                        <td><code class="inline-code">melo_[generated_on_seed]</code></td>
                    </tr>
                    <tr>
                        <td>Driver Email</td>
                        <td><code class="inline-code">driver@alsabiqoon.com</code></td>
                    </tr>
                    <tr>
                        <td>Driver Password</td>
                        <td><code class="inline-code">driver123</code></td>
                    </tr>
                    <tr>
                        <td>Admin Email</td>
                        <td><code class="inline-code">admin@alsabiqoon.com</code></td>
                    </tr>
                    <tr>
                        <td>Admin Password</td>
                        <td><code class="inline-code">admin123</code></td>
                    </tr>
                    <tr>
                        <td>Filament Admin Panel</td>
                        <td><code class="inline-code">http://localhost:8001/admin</code></td>
                    </tr>
                    <tr>
                        <td>Horizon Queue Dashboard</td>
                        <td><code class="inline-code">http://localhost:8001/horizon</code></td>
                    </tr>
                </tbody>
            </table>

            <h3>Cleanup Test Data</h3>
            <pre><code># Remove test data after running
docker compose exec backend php artisan test:melo-integration --cleanup

# Or manually via Tinker
docker compose exec backend php artisan tinker
>>> Trip::latest()->first()->delete()
>>> DeliveryRequest::latest()->first()->delete()</code></pre>
        </section>

        <!-- Production Configuration -->
        <section>
            <h2>Production Configuration</h2>

            <h3>Melo ERP Configuration</h3>
            <pre><code><span class="json-key">API Endpoint:</span> https://transportation.alsabiqoon.com/api/v1/delivery-requests
<span class="json-key">Method:</span> POST
<span class="json-key">Headers:</span>
  X-API-Key: &lt;provided_api_key&gt;
  Content-Type: application/json

<span class="json-key">Callback URL:</span> https://erp.melogroup.jo/api/delivery-callback</code></pre>

            <h3>Required Changes for Melo ERP</h3>
            <div class="alert alert-orange">
                <strong>To enable partial delivery tracking, Melo ERP must:</strong>
                <ol style="margin: 0.5rem 0 0 1.5rem;">
                    <li><strong>Send items</strong> with each destination (sku, product_name, qty)</li>
                    <li><strong>Handle delivered_items[]</strong> in callbacks (sku, qty_received, discrepancy_reason)</li>
                </ol>
                <p style="margin-top: 0.5rem; margin-bottom: 0;">
                    Both changes are <strong>backward compatible</strong> - existing integration works without items.
                </p>
            </div>

            <h3>Environment Variables</h3>
            <pre><code># Google Maps (Route Optimization)
GOOGLE_MAPS_API_KEY=your_production_key
GOOGLE_MAPS_MOCK_MODE=false

# Passport OAuth
PASSPORT_PASSWORD_CLIENT_ID=your_client_id
PASSPORT_PASSWORD_CLIENT_SECRET=your_client_secret

# Queue Processing
QUEUE_CONNECTION=redis
HORIZON_PREFIX=transportation-horizon:</code></pre>

            <div class="alert alert-info">
                <strong>Google Maps Costs:</strong><br>
                - Directions API: $5 per 1,000 requests (route optimization)<br>
                - Distance Matrix: $5 per 1,000 elements<br>
                - Navigation: FREE (uses device's Google Maps app)
            </div>
        </section>

        <footer>
            <p>Transportation App - Melo ERP Integration Documentation</p>
            <p>Generated: January 7, 2026 | Version: 2.0 (with Partial Delivery Support)</p>
        </footer>
    </div>
</body>
</html>
